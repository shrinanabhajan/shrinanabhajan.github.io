<!DOCTYPE html>
<!--python -m http.server 8000-->
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡•§‡•§ ‡§∂‡•ç‡§∞‡•Ä ‡§∏‡§™‡•ç‡§§‡§∂‡§§‡•Ä ‡§ó‡•Å‡§∞‡•Å‡§ö‡§∞‡§ø‡§§‡•ç‡§∞ ‡•§‡•§</title>
<style>
    body {
    margin: 0;
    font-family: sans-serif;
    background: #fefefe;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden; /* prevent body scroll */
    }

    /* Control bars */
    .control-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(34, 34, 34, 0.85); /* semi-transparent */
      color: #fff;
      padding: 8px;
      position: fixed;
      left: 0;
      right: 0;
      z-index: 100;
      transition: opacity 0.4s;
    }
    .top-bar { 
        top: 0; 
        display: none; /* hiding top bar */
    }
    .bottom-bar { 
    bottom: 0; 
    flex-direction: column;
    text-align: center;
    }

    .hidden { opacity: 0; pointer-events: none; }

    button {
      padding: 8px 12px;
      margin: 4px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background: #f99c4f;
      color: #363333;
      cursor: pointer;
    }
    /*button:hover { background: #666; }*/

    label {
        width: 80%;
    }
    .slider {
      width: 90%;
      margin: 10px auto;
    }

    .slider-wrapper {
      width: 90%;
      margin: 2px auto;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 6px; /* spacing to avoid overlap */
    }

    .slider-container input[type=range] {
      margin: 0 12px; /* give breathing room */
    }

    .slider-container button {
      flex-shrink: 0;
      width: 32px;
      height: 32px;
      border: 1px solid #aaa;
      background: #f99c4f;
      cursor: pointer;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }

    .slider-container button svg {
      width: 16px;
      height: 16px;
      pointer-events: none; /* üëà ensures clicks register only on the button */
    }

    /* Reading area fills everything */
    #reading-area {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      padding: 16px;
      line-height: 1.6;
      font-size: 28px;
      font-weight: 900;
      background: #fff;

      /*disable selection*/
      user-select: none;          /* Standard */
      -webkit-user-select: none;  /* Safari/Chrome */
      -ms-user-select: none;      /* IE/Edge (legacy) */
    }

    #reading-area img {
      width: 100%;
      height: auto;
    }

    
    #time-remaining {
      color: #f99c4f;
      font-size: 13px;
    }

    /* Floating play/pause button */
    #floatingPlayPause {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #f99c4f;
      color: white;
      border: none;
      font-size: 22px;
      cursor: pointer;
      display: none; /* hidden by default */
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      transition: background 0.2s;

      /* Center the text inside */
      display: flex;
      align-items: center;
      justify-content: center;

      /* Remove text baseline offset */
      line-height: 1;
      padding: 0;
    }

    /* Default */
    /* Grey text on light yellow */
    #reading-area.theme-1 {
      background: #ffffe0; /* light yellow */
      color: #3f3f3f;
    }

    /* Grey text on black */
    #reading-area.theme-2 {
      background: #111111; 
      color: #C9C9C9;
    }

    /* White text on black */
    #reading-area.theme-3 {
      background: #000000;
      color: #ffffff;
    }

    /* Light green on black */
    #reading-area.theme-4 {
      background: #000000;
      color: #90ee90; /* light green */
    }

    #reading-area.theme-5 {
      background: #ffffff;
      color: #000000;
    }

    @media (max-width: 600px) {
    button { font-size: 16px; padding: 6px 10px; }
    #reading-area { font-size: 28px; }
    }

</style>
</head>
<body>

<!-- Top control bar -->
<div id="top-bar" class="control-bar top-bar">
  <button onclick="prevFile()">&larr; Previous</button>
  <span id="file-name">File 1</span>
  <button onclick="nextFile()">Next &rarr;</button>
</div>

<!-- Reading area -->
<div id="reading-area" class="theme-1" onclick="toggleControls()">
  <p></p>
</div>

<!-- Bottom control bar -->
<div id="bottom-bar" class="control-bar bottom-bar">
  <div>
    <button onclick="playScroll()">Play</button>
    <button onclick="pauseScroll()">Pause</button>
    <button onclick="reset()">Reset</button>
    <button onclick="themeToggle()">Color</button>
  </div>

  <div class="slider-wrapper">
    <label for="speed-slider">Reading Speed: </label>
    <span id="speed-value">5</span>
    <div class="slider-container">
      <button class="down" aria-label="Decrease-speed">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </button>
      <input id="speed-slider" class="slider" type="range" min="1" max="30" value="5">
      <button class="up" aria-label="Increase-speed">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="18 15 12 9 6 15"></polyline>
        </svg>
      </button>
    </div>
  </div>

  <div class="slider-wrapper">
    <label for="font-slider">Text size: </label>
    <span id="font-value">28</span> 
    <div class="slider-container">
      <button class="down" aria-label="Decrease-font-size">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </button>
      <input id="font-slider" class="slider" type="range" min="8" max="72" value="28">
      <button class="up" aria-label="Increase-font-size">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="18 15 12 9 6 15"></polyline>
        </svg>
      </button>
    </div>
  </div>

  <div id="time-remaining">-</div>
  </div>

<!-- Floating Play/Pause Button -->
<!-- Inside the button -->
<button id="floatingPlayPause">
  <svg id="playIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="40" height="40" fill="white" style="margin: auto;">
    <path d="M8 5v14l11-7z"></path>
  </svg>
  <svg id="pauseIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="40" height="40" fill="white" style="margin: auto; display:none">
    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path>
  </svg>
</button>

<script>

    // === File navigation New ===
    let files = [];
    let currentFile = 0;
    const floatingBtn = document.getElementById("floatingPlayPause");
    const playIcon = document.getElementById("playIcon");
    const pauseIcon = document.getElementById("pauseIcon");

    
    // Floating button toggles auto scroll
    floatingBtn.addEventListener("click", toggleAutoScroll);

    // Load JSON on page start
    fetch("files.json")
      .then(res => res.json())
      .then(data => {
        files = data;
        if (files.length > 0) {
          loadFile(0);
        } else {
          document.getElementById("reading-area").innerHTML =
            "<p style='color:red'>No files found in files.json</p>";
        }
      })
      .catch(err => {
        document.getElementById("reading-area").innerHTML =
          "<p style='color:red'>Error loading files.json</p>";
      });

    function loadFile(idx) {
      if (idx < 0 || idx >= files.length) return;
      currentFile = idx;

      const { path, name } = files[currentFile];
      document.getElementById("file-name").textContent = name;

      fetch(path)
        .then(res => res.text())
        .then(html => {
          const readingArea = document.getElementById("reading-area");
          reset();
          readingArea.innerHTML = html;

        })
        .catch(err => {
          const readingArea = document.getElementById("reading-area");
          reset();
          readingArea.innerHTML = `<p style="color:red">Error loading file: ${path}</p>`;
        });
    }

    function prevFile() { loadFile(currentFile - 1); }
    function nextFile() { loadFile(currentFile + 1); }

    // === Autoscroll (smooth with requestAnimationFrame) ===
    let scrollAnim = null;
    let lastTimestamp = null;
    let isScrolling = false;

    function playScroll() {
        isScrolling = true;
        playIcon.style.display = "none";
        pauseIcon.style.display = "block";
        lastTimestamp = null;
        requestAnimationFrame(stepScroll);
    }

    function stepScroll(timestamp) {
        if (!isScrolling) return;
    
        if (lastTimestamp === null) lastTimestamp = timestamp;
        const elapsed = timestamp - lastTimestamp;
        lastTimestamp = timestamp;
    
        // Speed factor: pixels per second (slider value * 20)
        const speed = parseInt(document.getElementById("speed-slider").value, 10) * 20;
        const distance = (elapsed / 1000) * speed;
    
        const readingArea = document.getElementById("reading-area");
        readingArea.scrollTop += distance;
    
        // Stop at bottom
        if (readingArea.scrollTop + readingArea.clientHeight >= readingArea.scrollHeight) {
            stopScroll();
            return;
    }

    scrollAnim = requestAnimationFrame(stepScroll);
    }

    function pauseScroll() {
        isScrolling = false;
        playIcon.style.display = "block";
        pauseIcon.style.display = "none";
        if (scrollAnim) cancelAnimationFrame(scrollAnim);
    }

    function stopScroll() {
      isScrolling = false;
      playIcon.style.display = "block";
      pauseIcon.style.display = "none";
      if (scrollAnim) cancelAnimationFrame(scrollAnim);
      scrollAnim = null;
      lastTimestamp = null;
    }

    function reset() {
      stopScroll();
      const readingArea = document.getElementById("reading-area");
      readingArea.scrollTop = 0;
    }

    function toggleAutoScroll() {
      isScrolling ? pauseScroll() : playScroll();
    }


    // Scroll speed live update
    const speedSlider = document.getElementById("speed-slider");
    const speedValue = document.getElementById("speed-value");
    speedSlider.addEventListener("input", (e) => {
        speedValue.textContent = e.target.value;
    });

    // Font size live update
    const fontSlider = document.getElementById("font-slider");
    const fontValue = document.getElementById("font-value");
    fontSlider.addEventListener("input", (e) => {
        const val = e.target.value;
        document.getElementById("reading-area").style.fontSize = val + "px";
        fontValue.textContent = val;
    });

    // ---- Slider Buttons Logic ----
    document.querySelectorAll(".slider-container").forEach(container => {
      const slider = container.querySelector("input[type=range]");
      const btnUp = container.querySelector(".up");
      const btnDown = container.querySelector(".down");

      btnUp.addEventListener("click", e => {
        if (e.currentTarget !== btnUp) return; // safety
        slider.value = Math.min(slider.max, Number(slider.value) + Number(slider.step || 1));
        slider.dispatchEvent(new Event("input"));
      });

      btnDown.addEventListener("click", e => {
        if (e.currentTarget !== btnDown) return; // safety
        slider.value = Math.max(slider.min, Number(slider.value) - Number(slider.step || 1));
        slider.dispatchEvent(new Event("input"));
      });
    });


    // ---- Time Remaining Logic ----

    const readingArea = document.getElementById("reading-area");
    const timeRemainingDiv = document.getElementById("time-remaining");

    readingArea.addEventListener("scroll", () => {
      updateTimeRemaining();
    });

    function updateTimeRemaining() {
      const speed = parseInt(document.getElementById("speed-slider").value, 10) * 20;
      if (speed <= 0) {
        timeRemainingDiv.textContent = "";
        return;
      }

      const remaining = readingArea.scrollHeight - readingArea.clientHeight - readingArea.scrollTop;
      const seconds = remaining / speed;

      if (seconds < 1) {
        timeRemainingDiv.textContent = "";
      } else {
        timeRemainingDiv.textContent = `Time remaining: ${formatTime(seconds)}`;
      }
    }

    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return m > 0 ? `${m}m ${s}s` : `${s}s`;
    }

  // === Hide/Show controls ===
  let controlsVisible = true;
  let hideTimeout = null;

  function showControls() {
    document.getElementById("top-bar").classList.remove("hidden");
    document.getElementById("bottom-bar").classList.remove("hidden");
    floatingBtn.style.display = "none";
    controlsVisible = true;
    resetHideTimer();
  }

  function hideControls() {
    document.getElementById("top-bar").classList.add("hidden");
    document.getElementById("bottom-bar").classList.add("hidden");
    floatingBtn.style.display = "block";
    controlsVisible = false;
    if (hideTimeout) {
        clearTimeout(hideTimeout);
        hideTimeout = null;
    }
  }

  function toggleControls() {
    if (controlsVisible) {
      hideControls();
    } else {
      showControls();
    }
  }

  function resetHideTimer() {
    if (hideTimeout) clearTimeout(hideTimeout);
    hideTimeout = setTimeout(hideControls, 5000);
  }

  // Start auto hide
  showControls();
  //document.addEventListener("mousemove", showControls);
  //document.addEventListener("touchstart", showControls);

  // Initial load
  loadFile(currentFile);
    
  let wakeLock = null;

  // Function to request the wake lock
  async function requestWakeLock() {
    try {
      wakeLock = await navigator.wakeLock.request('screen');
      console.log("Screen Wake Lock is active.");
  
      // Handle release of the wake lock
      wakeLock.addEventListener('release', () => {
        console.log("Screen Wake Lock was released.");
      });
    } catch (err) {
      console.error(`Wake Lock error: ${err.name}, ${err.message}`);
    }
  }
  
  // Call requestWakeLock when the page is loaded
  document.addEventListener('DOMContentLoaded', requestWakeLock);
  
  // Optional: Re-request wake lock if it is released
  document.addEventListener('visibilitychange', () => {
    if (wakeLock !== null && document.visibilityState === 'visible') {
      requestWakeLock();
    }
  });


  //Theme
  const themeBtn = document.getElementById('theme-toggle');

  let currentTheme = 1;
  const totalThemes = 5;

  function themeToggle()  {
    // remove old theme class
    readingArea.classList.remove(`theme-${currentTheme}`);

    // cycle to next theme
    currentTheme = (currentTheme % totalThemes) + 1;

    // add new theme class
    readingArea.classList.add(`theme-${currentTheme}`);
  }

  readingArea.addEventListener("touchstart", (e) => {
    //e.preventDefault(); // prevents accidental tap scroll
    pauseScroll();
  }, { passive: false });

readingArea.addEventListener("touchend", playScroll);

</script>
</body>
</html>
