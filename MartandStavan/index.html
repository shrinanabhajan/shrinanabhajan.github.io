<!DOCTYPE html>
<!--python -m http.server 8000-->
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>।। श्री मार्तण्ड स्तवन ।।</title>
<style>
    body {
    margin: 0;
    font-family: sans-serif;
    background: #fefefe;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden; /* prevent body scroll */
    }

    /* Control bars */
    .control-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(34, 34, 34, 0.85); /* semi-transparent */
    color: #fff;
    padding: 8px;
    position: fixed;
    left: 0;
    right: 0;
    z-index: 100;
    transition: opacity 0.4s;
    }
    .top-bar { 
        top: 0; 
        display: none; /* hiding top bar */
    }
    .bottom-bar { 
    bottom: 0; 
    flex-direction: column;
    text-align: center;
    }

    .hidden { opacity: 0; pointer-events: none; }

    button {
    padding: 8px 12px;
    margin: 4px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    background: #f99c4f;
    color: #363333;
    cursor: pointer;
    }
    /*button:hover { background: #666; }*/

    label {
        width: 80%;
    }
    .slider {
    width: 90%;
    margin: 8px auto;
    }

    /* Reading area fills everything */
    #reading-area {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow-y: auto;
    padding: 16px;
    line-height: 1.6;
    font-size: 28px;
    background: #fff;
    }

    #reading-area img {
    width: 100%;
    height: auto;
    }

    @media (max-width: 600px) {
    button { font-size: 16px; padding: 6px 10px; }
    #reading-area { font-size: 28px; }
    }

</style>
</head>
<body>

<!-- Top control bar -->
<div id="top-bar" class="control-bar top-bar">
  <button onclick="prevFile()">&larr; Previous</button>
  <span id="file-name">File 1</span>
  <button onclick="nextFile()">Next &rarr;</button>
</div>

<!-- Reading area -->
<div id="reading-area" onclick="toggleControls()">
  <p></p>
</div>

<!-- Bottom control bar -->
<div id="bottom-bar" class="control-bar bottom-bar">
  <div>
    <button onclick="playScroll()">Play</button>
    <button onclick="pauseScroll()">Pause</button>
    <button onclick="reset()">Reset</button>
  </div>

  <label>
    Reading Speed 
    <input id="speed-slider" class="slider" type="range" min="1" max="20" value="5">
    <span id="speed-value">5</span>
  </label>

  <label>
    Text size 
    <input id="font-slider" class="slider" type="range" min="14" max="46" value="28">
    <span id="font-value">28</span>
  </label>
</div>

<script>
    // === File navigation old ===
    /*
    const files = [{path: "Adhyay-01.html", name: "अध्याय १"}, {path: "Adhyay-02.html", name: "अध्याय २"}, {path: "Adhyay-03.html", name: "अध्याय १"}]; // replace with your file list
    let currentFile = 0;

    function loadFile(idx) {
    if (idx < 0 || idx >= files.length) return;
    currentFile = idx;
    document.getElementById("file-name").textContent = files[currentFile].name;
    fetch(files[currentFile].path)
        .then(res => res.text())
        .then(html => {
        document.getElementById("reading-area").innerHTML = html;
        })
        .catch(err => {
        document.getElementById("reading-area").innerHTML =
            `<p style="color:red">Error loading file: ${files[currentFile]}</p>`;
        });
    }

    function prevFile() { loadFile(currentFile - 1); }
    function nextFile() { loadFile(currentFile + 1); }
    */

    // === File navigation New ===
    let files = [];
    let currentFile = 0;

    // Load JSON on page start
    fetch("files.json")
      .then(res => res.json())
      .then(data => {
        files = data;
        if (files.length > 0) {
          loadFile(0);
        } else {
          document.getElementById("reading-area").innerHTML =
            "<p style='color:red'>No files found in files.json</p>";
        }
      })
      .catch(err => {
        document.getElementById("reading-area").innerHTML =
          "<p style='color:red'>Error loading files.json</p>";
      });

    function loadFile(idx) {
      if (idx < 0 || idx >= files.length) return;
      currentFile = idx;

      const { path, name } = files[currentFile];
      document.getElementById("file-name").textContent = name;

      fetch(path)
        .then(res => res.text())
        .then(html => {
          const readingArea = document.getElementById("reading-area");
          readingArea.scrollTop = 0;
          readingArea.innerHTML = html;

        })
        .catch(err => {
          const readingArea = document.getElementById("reading-area");
          readingArea.scrollTop = 0;
          readingArea.innerHTML = `<p style="color:red">Error loading file: ${path}</p>`;
        });
    }

    function prevFile() { loadFile(currentFile - 1); }
    function nextFile() { loadFile(currentFile + 1); }

    // === Autoscroll (smooth with requestAnimationFrame) ===
    let scrollAnim = null;
    let lastTimestamp = null;
    let isScrolling = false;

    function playScroll() {
        isScrolling = true;
        lastTimestamp = null;
        requestAnimationFrame(stepScroll);
    }

    function stepScroll(timestamp) {
        if (!isScrolling) return;
    
        if (lastTimestamp === null) lastTimestamp = timestamp;
        const elapsed = timestamp - lastTimestamp;
        lastTimestamp = timestamp;
    
        // Speed factor: pixels per second (slider value * 20)
        const speed = parseInt(document.getElementById("speed-slider").value, 10) * 20;
        const distance = (elapsed / 1000) * speed;
    
        const readingArea = document.getElementById("reading-area");
        readingArea.scrollTop += distance;
    
        // Stop at bottom
        if (readingArea.scrollTop + readingArea.clientHeight >= readingArea.scrollHeight) {
            stopScroll();
            return;
    }

    scrollAnim = requestAnimationFrame(stepScroll);
    }

    function pauseScroll() {
        isScrolling = false;
        if (scrollAnim) cancelAnimationFrame(scrollAnim);
    }

    function stopScroll() {
      isScrolling = false;
      if (scrollAnim) cancelAnimationFrame(scrollAnim);
      scrollAnim = null;
      lastTimestamp = null;
    }

    function reset() {
      stopScroll();
      const readingArea = document.getElementById("reading-area");
      readingArea.scrollTop = 0;
    }


    // Scroll speed live update
    const speedSlider = document.getElementById("speed-slider");
    const speedValue = document.getElementById("speed-value");
    speedSlider.addEventListener("input", (e) => {
        speedValue.textContent = e.target.value;
    });

    // Font size live update
    const fontSlider = document.getElementById("font-slider");
    const fontValue = document.getElementById("font-value");
    fontSlider.addEventListener("input", (e) => {
        const val = e.target.value;
        document.getElementById("reading-area").style.fontSize = val + "px";
        fontValue.textContent = val;
    });

  // === Hide/Show controls ===
  let controlsVisible = true;
  let hideTimeout = null;

  function showControls() {
    document.getElementById("top-bar").classList.remove("hidden");
    document.getElementById("bottom-bar").classList.remove("hidden");
    controlsVisible = true;
    resetHideTimer();
  }

  function hideControls() {
    document.getElementById("top-bar").classList.add("hidden");
    document.getElementById("bottom-bar").classList.add("hidden");
    controlsVisible = false;
    if (hideTimeout) {
        clearTimeout(hideTimeout);
        hideTimeout = null;
    }
  }

  function toggleControls() {
    if (controlsVisible) {
      hideControls();
    } else {
      showControls();
    }
  }

  function resetHideTimer() {
    if (hideTimeout) clearTimeout(hideTimeout);
    hideTimeout = setTimeout(hideControls, 5000);
  }

  // Start auto hide
  showControls();
  //document.addEventListener("mousemove", showControls);
  //document.addEventListener("touchstart", showControls);

  // Initial load
  loadFile(currentFile);
</script>
</body>
</html>
